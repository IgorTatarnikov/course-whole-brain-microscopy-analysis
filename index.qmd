---
title: BrainGlobe and napari
subtitle: Whole brain microscopy analysis
author: Adam Tyson & Alessandro Felder
execute: 
  enabled: true
format:
    revealjs:
        theme: [default, bg-light.scss]
        logo: img/BG_logo.png
        footer: "SWC | 2023-12-06"
        slide-number: c
        menu:
            numbers: true
        chalkboard: true
        scrollable: true
        preview-links: false
        view-distance: 10
        mobile-view-distance: 10
        auto-animate: true
        auto-play-media: true
        code-overflow: wrap
        highlight-style: atom-one
        mermaid: 
          theme: neutral
          fontFamily: arial
          curve: linear
    html:
        theme: [default, bg-light.scss]
        logo: img/BG_logo.png
        date: "2023-12-06"
        toc: true
        code-overflow: scroll
        highlight-style: atom-one
        mermaid: 
          theme: neutral
          fontFamily: arial
          curve: linear
          margin-left: 0
        embed-resources: true
        page-layout: full
---
# Welcome

## Schedule

### Morning
::: {.incremental}
* Installation (AT & AF)
* Introduction to BrainGlobe (AT)
* Introduction to napari (AF)
* Napari demo (AF)
* BrainGlobe & napari (AF) 
* Whole brain atlas registration & segmentation (AT)
:::

## Schedule

### Afternoon
::: {.incremental}
* 3D cell detection (AT)
* Analysing silicon probe tracks (AT)
* Analysing bulk fluorescence (AT)
* Using BrainGlobe in your own software (AF)
* Wrap up and Q&A (AT & AF)
:::

# Installation

# BrainGlobe

## BrainGlobe Initiative {.smaller}

::: {.columns}
::: {.column width="55%"}
Established 2020 with three aims:

1. Develop general-purpose tools to help others build interoperable software
2. Develop specialist software for specific analysis and visualisation needs
3. Reduce barriers of entry, and facilitate the building of an ecosystem of computational neuroanatomy tools.
:::
::: {.column width="45%"}
![](img/tracing.png)
:::
:::

## BG
Established 2020 with three aims:

1. Develop general-purpose tools to help others build interoperable software
2. Develop specialist software for specific analysis and visualisation needs
3. Reduce barriers of entry, and facilitate the building of an ecosystem of computational neuroanatomy tools.

## BrainGlobe Atlas API
Initial observation - lots of similar communities working independently

- Model species
- Imaging modality
- Anatomical focus
- Developmental stage


::: footer
[Claudi, F., Petrucco, L., Tyson, A. L. et al (2020) “BrainGlobe Atlas API: a common interface for neuroanatomical atlases” Journal of Open Source Software, v5(54), 2668 ](https://doi.org/10.21105/joss.02668)
:::

## BrainGlobe Atlas API
![](img/atlases.png){}

::: footer
[Claudi, F., Petrucco, L., Tyson, A. L. et al (2020) “BrainGlobe Atlas API: a common interface for neuroanatomical atlases” Journal of Open Source Software, v5(54), 2668 ](https://doi.org/10.21105/joss.02668)
:::

## BrainGlobe Atlas API {.smaller}
**Currently implemented atlases**

* [Allen Mouse Brain Atlas](https://portal.brain-map.org/) at 10, 25, 50 and 100 micron resolutions
* [Allen Human Brain Atlas](https://portal.brain-map.org/) at 100 micron resolution
* [Max Planck Zebrafish Brain Atlas](http://fishatlas.neuro.mpg.de) at 1 micron resolution
* [Enhanced and Unified Mouse Brain Atlas](https://kimlab.io/brain-map/atlas/) at 10, 25, 50 and 100 micron resolutions
* [Smoothed version of the Kim et al. mouse reference atlas](https://doi.org/10.1016/j.celrep.2014.12.014) at 10, 25, 50 and 100 micron resolutions
* [Gubra's LSFM mouse brain atlas](https://doi.org/10.1007/s12021-020-09490-8) at 20 micron resolution
* [3D version of the Allen mouse spinal cord atlas](https://doi.org/10.1016/j.crmeth.2021.100074) at 20 x 10 x 10 micron resolution
* [AZBA: A 3D Adult Zebrafish Brain Atlas]( https://doi.org/10.7554/eLife.69988) at 4 micron resolution
* [Waxholm Space atlas of the Sprague Dawley rat brain](https://doi.org/10.1016/j.neuroimage.2014.04.001) at 39 micron resolution
* [3D Edge-Aware Refined Atlases Derived from the Allen Developing Mouse Brain Atlases](https://doi.org/10.7554/eLife.61408) (E13, E15, E18, P4, P14, P28 & P56)
* [Princeton Mouse Brain Atlas](https://brainmaps.princeton.edu/2020/09/princeton-mouse-brain-atlas-links) at 20 micron resolution
* [Kim Lab Developmental CCF (P56)](https://data.mendeley.com/datasets/2svx788ddf/1) at 10 micron resolution with 8 reference images - STP, LSFM (iDISCO) and MRI (a0, adc, dwo, fa, MTR, T2)

::: footer
[Claudi, F., Petrucco, L., Tyson, A. L. et al (2020) “BrainGlobe Atlas API: a common interface for neuroanatomical atlases” Journal of Open Source Software, v5(54), 2668 ](https://doi.org/10.21105/joss.02668)
:::


## BrainGlobe Atlas API{.smaller}

```python
from pprint import pprint
from bg_atlasapi.bg_atlas import BrainGlobeAtlas
atlas = BrainGlobeAtlas("allen_mouse_25um")

# reference image
reference_image = atlas.reference
print(reference_image.shape)
# (528, 320, 456)

# hemispheres image (value 1 in left hemisphere, 2 in right)
hemispheres_image = atlas.hemispheres
print(hemispheres_image.shape)
# (528, 320, 456)

VISp = atlas.structures["VISp"]
pprint(VISp)
# {'acronym': 'VISp',
#  'id': 385,
#  'mesh': None,
#  'mesh_filename': PosixPath('/home/user/.brainglobe/allen_mouse_25um_v0.3/meshes/385.obj')
#  'name': 'Primary visual area',
#  'rgb_triplet': [8, 133, 140],
#  'structure_id_path': [997, 8, 567, 688, 695, 315, 669, 385]}
```

::: footer
[Claudi, F., Petrucco, L., Tyson, A. L. et al (2020) “BrainGlobe Atlas API: a common interface for neuroanatomical atlases” Journal of Open Source Software, v5(54), 2668 ](https://doi.org/10.21105/joss.02668)
:::

## BrainGlobe Atlas API
![](img/brainglobe_cli.png){fig-align="center" width=110%}

::: footer
[Claudi, F., Petrucco, L., Tyson, A. L. et al (2020) “BrainGlobe Atlas API: a common interface for neuroanatomical atlases” Journal of Open Source Software, v5(54), 2668 ](https://doi.org/10.21105/joss.02668)
:::

## Whole brain microscopy
![](img/serial2p.png){fig-align="center" width=110%}

## Whole brain microscopy
![](img/serial2p_crop.png){fig-align="center" width=110%}



## cellfinder
![](img/raw.png){fig-align="center" width=70%}

::: footer
[Tyson, A. L., Rousseau, C. V., Niedworok, C. J. et al. (2021) “A deep learning algorithm for 3D cell detection in whole mouse brain image datasets" PLoS Comp Biol 17(5): e1009074.](https://doi.org/10.1371/journal.pcbi.1009074)
:::

## cellfinder
![](img/detect.png){fig-align="center" width=70%}

::: footer
[Tyson, A. L., Rousseau, C. V., Niedworok, C. J. et al. (2021) “A deep learning algorithm for 3D cell detection in whole mouse brain image datasets" PLoS Comp Biol 17(5): e1009074.](https://doi.org/10.1371/journal.pcbi.1009074)
:::

## cellfinder
![](img/classify.png){fig-align="center" width=70%}

::: footer
[Tyson, A. L., Rousseau, C. V., Niedworok, C. J. et al. (2021) “A deep learning algorithm for 3D cell detection in whole mouse brain image datasets" PLoS Comp Biol 17(5): e1009074.](https://doi.org/10.1371/journal.pcbi.1009074)
:::

## cellfinder
![](img/cells.png){fig-align="center" width=70%}

::: footer
[Tyson, A. L., Rousseau, C. V., Niedworok, C. J. et al. (2021) “A deep learning algorithm for 3D cell detection in whole mouse brain image datasets" PLoS Comp Biol 17(5): e1009074.](https://doi.org/10.1371/journal.pcbi.1009074)
:::

## brainglobe-segmentation
![](img/brainglobe-segmentation.png){fig-align="center" width=100%}

## brainrender {background-video="video/cellfinder_small.mp4" background-video-loop="true"}

# [BrainGlobe website](https://brainglobe.info/){preview-link="true" style="text-align: center"}

  

# napari

# napari demo

# BrainGlobe & napari

# Registration & segmentation

# Cell detection

# Silicon probe tracing

# Bulk fluorescence mapping

# BrainGlobe & your software
* Not just standalone tools
* Python APIs to help you build your own software
* Easy compatibility with other packages
* [Released tools](https://brainglobe.info/community/external-tools.html){preview-link="true"}

# Wrap up

## Resources
* [BrainGlobe website](https://brainglobe.info/){preview-link="true"}
* [Help forum](https://forum.image.sc/tag/brainglobe/){preview-link="true"}
* [Developer forum](https://brainglobe.zulipchat.com/){preview-link="true"}
* [GitHub](https://github.com/brainglobe/){preview-link="true"}



# Questions